# App 更新操作指南 (EAS Update)

本指南介绍如何在不重新安装 APK/IPA 的情况下，通过热更新 (OTA) 快速发布代码变更。

## 1. 什么时候可以用热更新？

你可以使用 `eas update` 进行热更新的情况：
*   ✅ 修改了 `.js`, `.ts`, `.tsx` 代码（业务逻辑、UI 布局）。
*   ✅ 修改了本地图片资源（`assets/` 下的图片）。
*   ✅ 修改了非原生相关的配置。

你**必须重新打包 (`eas build`)** 并让用户重新安装的情况：
*   ❌ `npm install` 了新的**原生依赖库**（涉及相机、蓝牙、地图等系统权限的库）。
*   ❌ 修改了 `app.json` 中的原生配置（如 `icon`, `splash`, `android.package`, `ios.bundleIdentifier`, 权限设置）。
*   ❌ 升级了 Expo SDK 版本。

## 2. 如何发布热更新

确保你的改动已经测试通过，然后运行：

```bash
eas update --branch preview --message "这里写更新日志，例如：修复登录页布局"
```

*   `--branch preview`: 指定更新推送到哪个分支（对应 `eas.json` 里的 channel）。通常我们把 preview profile 关联到 preview channel。
*   `--message`: 更新说明，方便自己在后台查看记录。

## 3. 用户如何接收更新

1.  **发布后**：更新包会被上传到 Expo 的 CDN 服务器。
2.  **用户端**：
    *   用户打开 App。
    *   App 会自动检测是否有新更新。
    *   **静默下载**：如果有，App 会在后台静默下载更新包（用户仍可正常使用旧版）。
    *   **生效**：当用户**下一次重启 App**（杀掉进程再进，或者第二次打开）时，就会自动加载新版本。

## 4. 常见问题

*   **更新没生效？**
    *   检查你的 App 构建时的 Channel 是否和 update 的 Channel 一致。
    *   检查 `eas.json` 里 `preview` profile 是否配置了 `"channel": "preview"`。
    *   让用户多重启几次 App。

*   **回滚版本**
    *   如果更新出错了，可以在 [expo.dev](https://expo.dev) 后台找到该次 update 并撤销，或者重新发布一个修复版 update。

