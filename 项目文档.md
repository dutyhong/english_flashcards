# 项目结构与文件说明文档

本项目是一个基于 **React Native (Expo)** 的英语单词卡片应用，集成了 **Supabase** 后端和 **阿里云 DashScope** AI 服务。

---

## 1. 根目录结构

| 文件/目录 | 作用 |
| --- | --- |
| `App.tsx` | **应用的入口组件**。负责初始化 Supabase 会话监听，配置全局 Navigation 路由结构 (Tab + Stack)。 |
| `app.json` | **Expo 配置文件**。定义 App 名称、图标、版本号、权限 (相机/相册)、iOS Bundle ID 和 Android Package Name。 |
| `eas.json` | **EAS Build 配置文件**。定义打包环境 (preview/production)，配置环境变量和构建策略。 |
| `package.json` | **项目依赖管理**。列出了所有安装的 npm 包及其版本，定义了启动脚本 (`start`, `android`, `ios`)。 |
| `tsconfig.json` | **TypeScript 配置**。定义 TS 编译选项，如路径别名、严格模式等。 |
| `babel.config.js` | **Babel 编译配置**。通常用于配置 Expo 预设和 Reanimated 插件。 |
| `metro.config.js` | **Metro 打包配置**。用于处理特定文件类型的打包规则。 |
| `src/` | **源代码目录**。所有业务逻辑代码都在这里。 |

---

## 2. 源代码目录 (`src/`)

### 2.1 页面视图 (`src/screens/`)

| 文件 | 作用 | 关键逻辑 |
| --- | --- | --- |
| **`AuthScreen.tsx`** | **登录/注册页** | - 用户名/密码登录<br>- 自动补全假邮箱后缀实现免验证注册<br>- 登录后自动跳转主页 |
| **`ScanScreen.tsx`** | **拍照/识别页** | - 调用相机或相册获取图片<br>- 调用 `AIService` 进行 OCR 识别<br>- 识别成功后跳转到选词页 |
| **`SelectWordScreen.tsx`** | **选词页** | - 展示 OCR 识别结果 (自动转小写)<br>- 用户勾选单词<br>- 调用 AI 生成释义并存入数据库<br>- 完成后跳转到复习列表 |
| **`ReviewScreen.tsx`** | **复习列表页** | - 展示单词列表<br>- **顶部筛选 Tab** (全部/熟练/模糊/忘记)<br>- 单词发音播放<br>- 点击跳转详情页 |
| **`WordDetailScreen.tsx`** | **单词详情页** | - 展示单词详细释义、音标、例句<br>- **底部状态按钮** (🟢熟练 🟡模糊 🔴忘记)<br>- 更新单词熟练度状态 |
| **`SettingsScreen.tsx`** | **设置页** | - 配置 API Key<br>- 切换演示模式 (Mock Data)<br>- **绑定真实邮箱** (密保功能)<br>- 退出登录 |

### 2.2 状态管理 (`src/store/`)

| 文件 | 作用 |
| --- | --- |
| **`useStore.ts`** | **全局状态中心 (Zustand)**。<br>- 管理 `session` (登录态)、`apiKey`、`reviewList` (单词数据)。<br>- 封装与 **Supabase** 的交互逻辑 (`fetchWords`, `addWord`, `updateWordStatus`)。<br>- 使用 `persist` 中间件持久化 API Key 到本地存储。 |

### 2.3 业务服务 (`src/services/`)

| 文件 | 作用 |
| --- | --- |
| **`ai.ts`** | **AI 逻辑封装**。<br>- `recognizeText`: 调用阿里云 Qwen-VL 模型进行图片 OCR。<br>- `enrichWord`: 调用 Qwen-Turbo 模型生成单词的 JSON 格式释义 (含中文、音标、例句)。<br>- 包含 Mock 数据用于演示模式。 |

### 2.4 工具库 (`src/lib/`)

| 文件 | 作用 |
| --- | --- |
| **`supabase.ts`** | **Supabase 客户端初始化**。<br>- 配置 Supabase URL 和 Anon Key。<br>- 集成 `AsyncStorage` 实现 Auth Session 的持久化 (自动登录)。 |

---

## 3. 数据流向图

1.  **用户操作**：拍照 -> `ScanScreen` 获取 Base64。
2.  **AI 处理**：调用 `AIService` (阿里云) -> 返回单词列表。
3.  **数据存储**：用户选词 -> `useStore.addWord` -> 写入 Supabase `user_words` 表。
4.  **复习交互**：
    *   `ReviewScreen` 读取 Store 中的 `reviewList` 渲染列表。
    *   `WordDetailScreen` 调用 `updateWordStatus` -> 更新数据库状态字段。
5.  **状态同步**：`useFocusEffect` 监听页面焦点 -> 触发 `fetchWords` 重新拉取最新数据。

## 4. 技术栈总结

*   **框架**: React Native (Expo SDK 54)
*   **语言**: TypeScript
*   **UI**: React Native 原生组件 + Lucide Icons
*   **状态管理**: Zustand
*   **后端**: Supabase (PostgreSQL + Auth)
*   **AI**: Alibaba Cloud DashScope (通义千问)
*   **TTS**: expo-speech (文字转语音)

